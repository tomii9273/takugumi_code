name: Check Math Formula

on:
  push:
    branches:
      - main

jobs:
  check-math-formula:
    runs-on: ubuntu-latest
    timeout-minutes: 1
    steps:
      - uses: actions/checkout@v3

      - name: List files in the src directory
        run: ls -la src/

      - name: Display the content of README.md
        run: cat src/README.md

      - name: Check
        run: |
          echo "start"
          n_head_line=$(grep -o '^\$' src/README.md | wc -l)
          n_tail_line=$(grep -o '\$$' src/README.md | wc -l)
          n_head_bracket=$(grep -o '(\$' src/README.md | wc -l)
          n_tail_bracket=$(grep -o '\$)' src/README.md | wc -l)
          n_head=$(grep -o ' \$' src/README.md | wc -l)
          n_tail=$(grep -o '\$ ' src/README.md | wc -l)
          n_valid=$((n_head_line+n_tail_line+n_head_bracket+n_tail_bracket+n_head+n_tail))
          n_all=$(grep -o '\$' src/README.md | wc -l)

          echo "count end"

          echo $n_head_line
          echo $n_tail_line
          echo $n_head_bracket
          echo $n_tail_bracket
          echo $n_head
          echo $n_tail
          echo $n_valid
          echo $n_all

          echo "output end"

          if [ $n_all -ne $n_valid ]; then
              echo "not equal"
              echo $n_all
              echo $n_valid
              exit 2
          fi
          echo "finished"
        shell: bash
